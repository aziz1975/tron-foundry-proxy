name: test

on:
  workflow_dispatch:

jobs:
  forge-test:
    name: Forge tests
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Install Foundry
        uses: foundry-rs/foundry-toolchain@v1
        with:
          version: stable

      - name: Install dependencies (OpenZeppelin)
        run: |
          # Install OpenZeppelin into lib/ so imports like
          # "openzeppelin-contracts/contracts/access/Ownable.sol" work.
          forge install --no-git OpenZeppelin/openzeppelin-contracts@v5.5.0

          # Useful debug output
          ls -la lib || true
          ls -la lib/openzeppelin-contracts/contracts/access/Ownable.sol

      - name: Build (CI profile)
        env:
          FOUNDRY_PROFILE: ci
        run: forge build -vvv

      - name: Test (CI profile)
        env:
          FOUNDRY_PROFILE: ci
        run: forge test -vvv
